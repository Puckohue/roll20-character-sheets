<div>
    <button type="action" name="act_basic" >Basic</button>
    <button type="action" name="act_attributes" >Attributes & Skills</button>
    <button type="action" name="act_combat" >Combat & Health</button>
    <button type="action" name="act_gear" >Gear</button>
</div>
<input type='hidden' class='sheet-tabstoggle' name='attr_sheetTab'  value='basic'  />
<br />

<div class='sheet-basic'>
	<div class="3colrow">
		<div class="col">
			<img src="https://raw.githubusercontent.com/Puckohue/roll20-character-sheets/t2k4e/Twilight-2000-v4/logo.png" />
		</div>
	    <div class="col">
    		<label>Name</label><input type="text" name="attr_character_name" />
		</div>
		<div class="col">
			<label>Nationality</label><input type="text" name="attr_nationality" />
		</div>
	</div>

	<hr/>

	<div class="3colrow">
		<div class="col">
			<label>Branch</label><input type="text" name="attr_branch" />
			<br /><br />
           	<label>Military Rank</label><input type="text" name="attr_militaryrank" />
			<br /><br />
           	<label>Buddy</label><input type="text" name="attr_buddy" />
		</div>
		<div class="col">
			<label>Appearance</label><textarea name="attr_appearance"></textarea>
      	</div>
		<div class="col">
			<label>Moral Code</label><textarea name="attr_moralcode"></textarea>
		</div>
	</div>
	
	<br />
	
	<div class="3colrow">
		<div class="col">
			<label>Big Dream</label><textarea name="attr_bigdream"></textarea>
     	 </div>
		<div class="col">
			<label>How You Met The Group</label><textarea name="attr_howyoumetthegroup"></textarea>
		</div>
		<div class="col">
			<label>Experience</label>
			<p class="lesserLabel">
				<strong>Current </strong><input type="number" name="attr_currentexperience" />
			</p>
			<p class="lesserLabel">
				<strong>Total </strong><input type="number" name="attr_totalexperience" />
			</p>
			<br /><br />
		</div>
     </div>
</div>

<div class='sheet-attributes'>
	<div class="row">
		<img src="https://raw.githubusercontent.com/Puckohue/roll20-character-sheets/t2k4e/Twilight-2000-v4/logo.png" />
	</div>
	<br />
	<h2>Attributes & Skills</h2>

	<hr />

	<input name="attr_strengthdie" type="hidden">
	<input name="attr_heavyweaponsdie" type="hidden">
	<input name="attr_closecombatdie" type="hidden">
	<input name="attr_staminadie" type="hidden">
	<input name="attr_agilitydie" type="hidden">
	<input name="attr_drivingdie" type="hidden">
	<input name="attr_mobilitydie" type="hidden">
	<input name="attr_rangedcombatdie" type="hidden">
	<input name="attr_intelligencedie" type="hidden">
	<input name="attr_recondie" type="hidden">
	<input name="attr_survivaldie" type="hidden">
	<input name="attr_techdie" type="hidden">
	<input name="attr_empathydie" type="hidden">
	<input name="attr_commanddie" type="hidden">
	<input name="attr_persuasiondie" type="hidden">
	<input name="attr_medicalaiddie" type="hidden">

	<div class="moddie-section">
		<span>
			<label>Die 1</label>
			<select name='attr_die1' class='sheet-short'>
				<option value='12'>d12</option><option value='10'>d10</option>
				<option value='8' selected="selected">d8</option>
				<option value='6'>d6</option>
			</select>
		</span>
		<span>
			<label>Die 2</label>
			<select name='attr_die2' class='sheet-short'>
				<option value=''></option>
				<option value='12'>d12</option>
				<option value='10'>d10</option>
				<option value='8' selected="selected">d8</option>
				<option value='6'>d6</option>
			</select>
		</span>
		<span>
			<label>AmmoDice</label><input type="number" name="attr_ammodice" />
		</span>
		<span>
			<h3>&nbsp;</h3>
			<button type='roll' name='roll_generaldice' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{die1}cs>10cf<5>10f<5 + 1)+(1d@{die2}cs>10cf<5>10f<5 + 1)+@{ammodice}d6>6]]}}'></button>
		</span>
	</div>
	<br />
	<hr />

	<div class="skill-section">
	     <span>
			<label>STRENGTH</label>
			<select name='attr_strength' class='sheet-short'>
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C' selected="selected">C</option>
				<option value='D'>D</option>
			</select>
			<button type='roll' name='roll_strength' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{strenghtdie}cs>10cf<5>10f<5 + 1)]]}}'></button>
			<br />
			<br />
			
			<label>Heavy Weapons</label>
			<select name='attr_heavyweapons' class='sheet-short'>
				<option value=''></option>
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C'>C</option>
				<option value='D'>D</option>
			</select>
			<button type='roll' name='roll_heavyweapons' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{heavyweaponsdie}cs>10cf<5>10f<5 + 1)+(1d@{strengthdie}cs>10cf<5>10f<5 + 1)]]}}'></button>
			<br />
			<br />
			
			<label>Close Combat</label>
			<select name='attr_closecombat' class='sheet-short'>
				<option value=''></option>
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C'>C</option>
				<option value='D'>D</option>
			</select>
			<button type='roll' name='roll_closecombat' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{closecombatdie}cs>10cf<5>10f<5 + 1)+(1d@{strengthdie}cs>10cf<5>10f<5 + 1)]]}}'></button>
			<br />
			<br />
			
			<label>Stamina</label>
			<select name='attr_stamina' class='sheet-short'>
				<option value=''></option>
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C'>C</option>
				<option value='D'>D</option>
			</select>
        		<button type='roll' name='roll_stamina' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{staminadie}cs>10cf<5>10f<5 + 1)+(1d@{strengthdie}cs>10cf<5>10f<5 + 1)]]}}'></button>
			<hr />
		</span>
	     <span>
			<label>AGILITY</label>
			<select name='attr_agility' class='sheet-short'>
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C' selected="selected">C</option>
				<option value='D'>D</option>
			</select>
			<button type='roll' name='roll_agility' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{agilitydie}cs>10cf<5>10f<5 + 1)]]}}'></button>
			<br />
			<br />
			
			<label>Driving</label>
			<select name='attr_driving' class='sheet-short'>
				<option value=''></option>
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C'>C</option>
				<option value='D'>D</option>
			</select>
			<button type='roll' name='roll_driving' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{drivingdie}cs>10cf<5>10f<5 + 1)+(1d@{agilitydie}cs>10cf<5>10f<5 + 1)]]}}'></button>
			<br />
			<br />
			
			<label>Mobility</label>
			<select name='attr_mobility' class='sheet-short'>
				<option value=''></option>
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C'>C</option>
				<option value='D'>D</option>
			</select>
			<button type='roll' name='roll_mobility' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{mobilitydie}cs>10cf<5>10f<5 + 1)+(1d@{agilitydie}cs>10cf<5>10f<5 + 1)]]}}'></button>
			<br />
			<br />
			
			<label>Ranged Combat</label>
			<select name='attr_rangedcombat' class='sheet-short'>
				<option value=''></option>
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C'>C</option>
				<option value='D'>D</option>
			</select>
			<button type='roll' name='roll_rangedcombat' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{rangedcombatdie}cs>10cf<5>10f<5 + 1)+(1d@{agilitydie}cs>10cf<5>10f<5 + 1)]]}}'></button>
			<hr />
		</span>
	     <span>
			<label>INTELLIGENCE</label>
			<select name='attr_intelligence' class='sheet-short'>
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C' selected="selected">C</option>
				<option value='D'>D</option>
			</select>
			<button type='roll' name='roll_intelligence' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{intelligencedie}cs>10cf<5>10f<5 + 1)]]}}'></button>
			<br />
			<br />
			
			<label>Recon</label>
			<select name='attr_recon' class='sheet-short'>
				<option value=''></option>
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C'>C</option>
				<option value='D'>D</option>
			</select>
			<button type='roll' name='roll_recon' value='&{template:default} {{name=@{character_name}}} {{result=[[1d@{recondie}>6cs>10+(1d@{intelligencedie}cs>10cf<5>10f<5 + 1)]]}}'></button>
			<br />
			<br />
			
			<label>Survival</label>
			<select name='attr_survival' class='sheet-short'>
				<option value=''></option>
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C'>C</option>
				<option value='D'>D</option>
			</select>
			<button type='roll' name='roll_survival' value='&{template:default} {{name=@{character_name}}} {{result=[[1d@{survivaldie}>6cs>10+(1d@{intelligencedie}cs>10cf<5>10f<5 + 1)]]}}'></button>
			<br />
			<br />
			
			<label>Tech</label>
			<select name='attr_tech' class='sheet-short'>
				<option value=''></option>
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C'>C</option>
				<option value='D'>D</option>
			</select>
			<button type='roll' name='roll_tech' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{techdie}cs>10cf<5>10f<5 + 1)+(1d@{intelligencedie}cs>10cf<5>10f<5 + 1)]]}}'></button>
			<hr />
		</span>
	     <span>
			<label>EMPATHY</label>
			<select name='attr_empathy' class='sheet-short'>
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C' selected="selected">C</option>
				<option value='D'>D</option>
			</select>
			<button type='roll' name='roll_empathy' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{empathydie}cs>10cf<5>10f<5 + 1)]]}}'></button>
			<br />
			<br />
			
			<label>Command</label>
			<select name='attr_command' class='sheet-short'>
				<option value=''></option>
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C'>C</option>
				<option value='D'>D</option>
			</select>
			<button type='roll' name='roll_command' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{commanddie}cs>10cf<5>10f<5 + 1)+(1d@{empathydie}cs>10cf<5>10f<5 + 1)]]}}'></button>
			<br />
			<br />
			
			<label>Persuasion</label>
			<select name='attr_persuasion' class='sheet-short'>
				<option value=''></option>
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C'>C</option>
				<option value='D'>D</option>
			</select>
			<button type='roll' name='roll_persuasion' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{persuasiondie}cs>10cf<5>10f<5 + 1)+(1d@{empathydie}cs>10cf<5>10f<5 + 1)]]}}'></button>
			<br />
			<br />
			
			<label>Medical Aid</label>
			<select name='attr_medicalaid' class='sheet-short'>
				<option value=''></option>
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C'>C</option>
				<option value='D'>D</option>
			</select>
			<button type='roll' name='roll_medicalaid' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{medicalaiddie}cs>10cf<5>10f<5 + 1)+(1d@{empathydie}cs>10cf<5>10f<5 + 1)]]}}'></button>
			<hr />
		</span>
	</div>
	<div class="row">
		<h3>Specialties</h3>
		<fieldset class="repeating_specialties"> 
			<label>Specialty:</label><textarea name="attr_specialty"></textarea>
		</fieldset>
      </div>
</div>

<div class='sheet-combat'>
	<div class="row">
          <img src="https://raw.githubusercontent.com/Puckohue/roll20-character-sheets/t2k4e/Twilight-2000-v4/logo.png" />
     </div>
	<br />

	<h2>Combat</h2>

	<hr />

	<div class="3colrow">
		<div class="col">
			<label>Damage</label><input type="number" name="attr_damage" />
			<br /><br />
			<label>Hit Capacity</label><input type="number" name="attr_hitcapacity" value="ceil((@{strengthdie}+@{agilitydie})/4)" disabled="true" />
		</div>
		<div class="col">
			<label>Stress</label><input type="number" name="attr_stress" />
			<br /><br />
			<label>Stress Capacity</label><input type="number" name="attr_stresscapacity" value="ceil((@{intelligencedie}+@{empathydie})/4)" disabled="true" />
		</div>
		<div class="col">

		</div>
	</div>
	<hr />
	<div class="moddie-section">
		<span>
			<label>Die 1</label>
			<select name='attr_die1' class='sheet-short'>
				<option value='12'>d12</option>
				<option value='10'>d10</option>
				<option value='8' selected="selected">d8</option>
				<option value='6'>d6</option>
			</select>
		</span>
		<span>
			<label>Die 2</label>
			<select name='attr_die2' class='sheet-short'>
				<option value=''></option>
				<option value='12'>d12</option>
				<option value='10'>d10</option>
				<option value='8' selected="selected">d8</option>
				<option value='6'>d6</option>
			</select>
		</span>
		<span>
			<label>AmmoDice</label><input type="number" name="attr_ammodice" />
		</span>
		<span>
			<h3>&nbsp;</h3>
			<button type='roll' name='roll_generaldice' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{die1}cs>10cf<5>10f<5 + 1)+(1d@{die2}cs>10cf<5>10f<5 + 1)+@{ammodice}d6>6]]}}'></button>
		</span>
	</div>
	<div class="row">
		<p>&nbsp;</p>
	</div>
	<div class="row">
		<p>&nbsp;</p>
	</div>
	<div class="3colrow">
		<div class="col">
			<span class="lesserLabel">Ranged Combat </span><button type='roll' name='roll_rangedcombat' value='&{template:default} {{name=@{character_name}}} {{result=[[(1d@{rangedcombatdie}cs>10cf<5>10f<5 + 1)+(1d@{agilitydie}cs>10cf<5>10f<5 + 1)+?{Number of Ammodice|1}d6>6]]}}'></button>
		</div>
		<div class="col">
			<span class="lesserLabel">Close Combat </span><button type='roll' name='roll_closecombat' value='&{template:default} {{name=@{character_name}}} {{result=[[1d@{closecombatdie}>6cs>10+1d@{strengthdie}>6cs>10]]}}'></button>
		</div>
		<div class="col">
			<span class="lesserLabel">CUF </span>
			<select name='attr_CUF' class='sheet-short'>
				<option value=''></option><
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C'>C</option>
				<option value='D'>D</option>
			</select>
		</div>
	</div>
	<div class="row">
		<h3>Weapons</h3>
		<div class="weapon-section">
			<span>Name</span>
			<span>Type</span>
			<span>Ammo</span>
			<span>RoF</span>
			<span>Dam</span>
			<span>Crit</span>
			<span>Armor</span>
			<span>Rel.</span>
			<span>Range</span>
			<span>Blast</span>
			<span>Weight</span>
			<span>Mag</span>
			<span>Spent</span>
		</div>
	</div>
	<div class="row">
		<fieldset class="repeating_weapons">
			<div class="weapon-section">
				<input type="text" name="attr_weapon_name" />
				<select name='attr_weapon_type' class='sheet-short'>
					<option value=''></option><
					<option value='SMG'>SMG</option>
					<option value='LMG'>LMG</option>
					<option value='GPMG'>GPMG</option>
					<option value='HMG'>HMG</option>
					<option value='GL'>GL</option>
					<option value='RL'>RL</option>
					<option value='ATRL'>ATRL</option>
					<option value='ATGM'>ATGM</option>
				</select>
				<input type="number" name="attr_weapon_ammotype" />
				<input type="number" name="attr_weapon_rof" />
				<input type="number" name="attr_weapon_damage" />
				<input type="number" name="attr_weapon_crit" />
				<input type="number" name="attr_weapon_armor" />
				<select name='attr_weapon_reliability' class='sheet-short'>
					<option value='A'>A</option>
					<option value='B'>B</option>
					<option value='C'>C</option>
					<option value='D'>D</option>
				</select>
				<input type="number" name="attr_weapon_range" />
				<input type="number" name="attr_weapon_blast" />
				<select name='attr_weapon_blast' class='sheet-short'>
					<option value=''></option>
					<option value='A'>A</option>
					<option value='B'>B</option>
					<option value='C'>C</option>
					<option value='D'>D</option>
				</select>
				<input type="number" name="attr_weapon_weight" />
				<input type="number" name="attr_weapon_mag" />
				<input type="number" name="attr_weapon_spent_ammo" />
			</div>
		</fieldset>
	</div>

	<hr />

	<div class="row">
		<h3>Armor</h3>
		<div class="armor-section">
			<span>Location</span>
			<span>Name</span>
			<span>Rating</span>
			<span>Weight</span>
		</div>
		<div class="row">
			<fieldset class="repeating_armor">
				<div class="armor-section">
					<select name="attr_armorbodypart">
						<option value="Head" selected="selected">Head</option>
						<option value="Arms">Arms</option>
						<option value="Torso">Torso</option>
						<option value="Legs">Legs</option>
					</select>
					<input type="text" name="attr_armorname" />
					<input type="number" name="attr_armorrating" />
					<input type="number" name="attr_armorweight" />
				</div>
			</fieldset>
		</div>
	</div>
	<hr />
	<div class="3colrow">
		<div class="col">
			<h3>Critical Injuries</h3>
			<fieldset class="repeating_criticalinjuries"> 
				<textarea name="attr_criticalinjury"></textarea>
			</fieldset>
     		</div>
		<div class="col">
			<h3>Diseases</h3>
			<fieldset class="repeating_diseases"> 
				<textarea name="attr_disease"></textarea>
			</fieldset>
		</div>
			<div class="col">
			<h3>Radiation</h3>
			<p class="lesserLabel">
				<strong>Temporary </strong><input type="number" name="attr_temporaryradiation" />
			</p>
			<p class="lesserLabel">
				<strong>Permanent </strong><input type="number" name="attr_permanentradiation" />
			</p>
			<br />
		</div>
	</div>
</div>

<div class='sheet-gear'>
	<div class="row">
          <img src="https://raw.githubusercontent.com/Puckohue/roll20-character-sheets/t2k4e/Twilight-2000-v4/logo.png" />
     </div>
	<br />
	<h2>Gear</h2>

	<hr />

	<div class="2colrow">
		<div class="col">
			<h3>Combat Gear</h3>
			<p class="lesserLabel">Carry Limit <span name="attr_strengthdie"></span></p>
			<p class="lesserLabel"><strong>Bonus </strong><input type="number" name="attr_combatgearbonus" /></p>
			<p class="lesserLabel"><strong>Total ENC </strong><span name="attr_combatgear_total"></span></p>
			<p>&nbsp;</p>
			<div class="combatgear-section">
				<span><h4>Item</h4></span>
				<span><h4>Weight</h4></span>
			</div>
			<fieldset class="repeating_combatgearitems">
				<div class="combatgear-section">
					<span>
						<input type="text" name="attr_combatgearitem" />
					</span>
					<span>
						<input type="number" placeholder="1.0" step="0.05" min="0" max="10" name="attr_combatgearweight" />
					</span>
				</div>
			</fieldset>
		</div>
		<div class="col">
			<h3>Backpack</h3>
			<p class="lesserLabel">Carry Limit <span name="attr_strengthdie"></span></p>
			<p class="lesserLabel"><strong>Bonus </strong><input type="number" name="attr_backpackbonus" /></p>
			<p class="lesserLabel"><strong>Total ENC </strong><span name="attr_backpack_total"></span></p>
			<p>&nbsp;</p>
			<div class="combatgear-section">
				<span><h4>Item</h4></span>
				<span><h4>Weight</h4></span>
			</div>
			<fieldset class="repeating_backpackitems">
				<div class="combatgear-section">
					<span>
						<input type="text" name="attr_backpackitem" />
					</span>
					<span>
						<input type="number" placeholder="1.0" step="0.05" min="0" max="10" name="attr_backpackweight" />
					</span>
				</div>
			</fieldset>
		</div>
	</div>
	<br />
	<hr />

	<div class="row">
		<h3>Tiny Items</h3>
		<fieldset class="repeating_tinyitems">
			<input type="text" name="attr_tinyitem" />
		</fieldset>
	</div>
	<br /><br />
</div>


<script type="text/worker">
    const buttonlist = ["basic","attributes","combat","gear"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    });

	on("change:strength sheet:opened", function() {  
		getAttrs(["strength"], function(values) {
        		const str = values.strength;
			var strdie = 8;
			if (str == "A") strdie = 12;
			if (str == "B") strdie = 10;
			if (str == "C") strdie = 8;
			if (str == "D") strdie = 6;
			setAttrs({strengthdie: strdie});
		});
	});

	on("change:heavyweapons sheet:opened", function() {  
		getAttrs(["heavyweapons"], function(values) {
        		const hvy = values.heavyweapons;
			var hvydie = 0;
			if (hvy == "A") hvydie = 12;
			if (hvy == "B") hvydie = 10;
			if (hvy == "C") hvydie = 8;
			if (hvy == "D") hvydie = 6;
			setAttrs({heavyweaponsdie: hvydie });
		});
	});

	on("change:closecombat sheet:opened", function() {  
		getAttrs(["closecombat"], function(values) {
        		const cls = values.closecombat;
			var clsdie = 0;
			if (cls == "A") clsdie = 12;
			if (cls == "B") clsdie = 10;
			if (cls == "C") clsdie = 8;
			if (cls == "D") clsdie = 6;
			setAttrs({closecombatdie: clsdie });
		});
	});

	on("change:stamina sheet:opened", function() {  
		getAttrs(["stamina"], function(values) {
        		const sta = values.stamina;
			var stadie = 0;
			if (sta == "A") stadie = 12;
			if (sta == "B") stadie = 10;
			if (sta == "C") stadie = 8;
			if (sta == "D") stadie = 6;
			setAttrs({staminadie: stadie });
		});
	});

	on("change:agility sheet:opened", function() {  
		getAttrs(["agility"], function(values) {
        		const agi = values.agility;
			var agidie = 8;
			if (agi == "A") agidie = 12;
			if (agi == "B") agidie = 10;
			if (agi == "C") agidie = 8;
			if (agi == "D") agidie = 6;
			setAttrs({agilitydie: agidie });
		});
	});

	on("change:driving sheet:opened", function() {  
		getAttrs(["driving"], function(values) {
        		const dri = values.driving;
			var dridie = 0;
			if (dri == "A") dridie = 12;
			if (dri == "B") dridie = 10;
			if (dri == "C") dridie = 8;
			if (dri == "D") dridie = 6;
			setAttrs({drivingdie: dridie });
		});
	});

	on("change:mobility sheet:opened", function() {  
		getAttrs(["mobility"], function(values) {
        		const mob = values.mobility;
			var mobdie = 0;
			if (mob == "A") mobdie = 12;
			if (mob == "B") mobdie = 10;
			if (mob == "C") mobdie = 8;
			if (mob == "D") mobdie = 6;
			setAttrs({mobilitydie: mobdie });
		});
	});

	on("change:rangedcombat sheet:opened", function() {  
		getAttrs(["rangedcombat"], function(values) {
        		const ran = values.rangedcombat;
			var randie = 0;
			if (ran == "A") randie = 12;
			if (ran == "B") randie = 10;
			if (ran == "C") randie = 8;
			if (ran == "D") randie = 6;
			setAttrs({rangedcombatdie: randie });
		});
	});

	on("change:intelligence sheet:opened", function() {  
		getAttrs(["intelligence"], function(values) {
        		const int = values.intelligence;
			var intdie = 8;
			if (int == "A") intdie = 12;
			if (int == "B") intdie = 10;
			if (int == "C") intdie = 8;
			if (int == "D") intdie = 6;
			setAttrs({intelligencedie: intdie });
		});
	});

	on("change:recon sheet:opened", function() {  
		getAttrs(["recon"], function(values) {
        		const rec = values.recon;
			var recdie = 0;
			if (rec == "A") recdie = 12;
			if (rec == "B") recdie = 10;
			if (rec == "C") recdie = 8;
			if (rec == "D") recdie = 6;
			setAttrs({recondie: recdie });
		});
	});

	on("change:survival sheet:opened", function() {  
		getAttrs(["survival"], function(values) {
        		const sur = values.survival;
			var surdie = 0;
			if (sur == "A") surdie = 12;
			if (sur == "B") surdie = 10;
			if (sur == "C") surdie = 8;
			if (sur == "D") surdie = 6;
			setAttrs({survivaldie: surdie });
		});
	});

	on("change:tech sheet:opened", function() {  
		getAttrs(["tech"], function(values) {
        		const tec = values.tech;
			var tecdie = 0;
			if (tec == "A") tecdie = 12;
			if (tec == "B") tecdie = 10;
			if (tec == "C") tecdie = 8;
			if (tec == "D") tecdie = 6;
			setAttrs({techdie: tecdie });
		});
	});

	on("change:empathy sheet:opened", function() {  
		getAttrs(["empathy"], function(values) {
        		const emp = values.empathy;
			var empdie = 8;
			if (emp == "A") empdie = 12;
			if (emp == "B") empdie = 10;
			if (emp == "C") empdie = 8;
			if (emp == "D") empdie = 6;
			setAttrs({empathydie: empdie });
		});
	});

	on("change:command sheet:opened", function() {  
		getAttrs(["command"], function(values) {
        		const com = values.command;
			var comdie = 0;
			if (com == "A") comdie = 12;
			if (com == "B") comdie = 10;
			if (com == "C") comdie = 8;
			if (com == "D") comdie = 6;
			setAttrs({commanddie: comdie });
		});
	});

	on("change:persuasion sheet:opened", function() {  
		getAttrs(["persuasion"], function(values) {
        		const per = values.persuasion;
			var perdie = 0;
			if (per == "A") perdie = 12;
			if (per == "B") perdie = 10;
			if (per == "C") perdie = 8;
			if (per == "D") perdie = 6;
			setAttrs({persuasiondie: perdie });
		});
	});

	on("change:medicalaid sheet:opened", function() {  
		getAttrs(["medicalaid"], function(values) {
        		const med = values.medicalaid;
			var meddie = 0;
			if (med == "A") meddie = 12;
			if (med == "B") meddie = 10;
			if (med == "C") meddie = 8;
			if (med == "D") meddie = 6;
			setAttrs({medicalaiddie: meddie });
		});
	});

	on('change:repeating_combatgearitems:combatgearweight remove:repeating_combatgearitems', function() {
		repeatingSum("combatgear_total","combatgearitems","combatgearweight");
	});

	on('change:repeating_backpackitems:backpackweight remove:repeating_backpackitems', function() {
		repeatingSum("backpack_total","backpackitems","backpackweight");
	});

	/* ===== PARAMETERS ==========
		destinations = the name of the attribute that stores the total quantity
		can be a single attribute, or an array: ['total_cost', 'total_weight']
		If more than one, the matching fields must be in the same order. 
		section = name of repeating fieldset, without the repeating_
		fields = the name of the attribute field to be summed
		destination and fields both can be a single attribute: 'weight'
		or an array of attributes: ['weight','number','equipped']
	*/
	const repeatingSum = (destinations, section, fields) => {
		if (!Array.isArray(destinations)) destinations = [destinations.replace(/\s/g, '').split(',')];
		if (!Array.isArray(fields)) fields = [fields.replace(/\s/g, '').split(',')];
		getSectionIDs(`repeating_${section}`, idArray => {
			const attrArray = idArray.reduce((m, id) => [...m, ...(fields.map(field => `repeating_${section}_${id}_${field}`))], []);
			getAttrs([...attrArray], v => {
				const getValue = (section, id, field) => v[`repeating_${section}_${id}_${field}`] === 'on' ? 1 : parseFloat(v[`repeating_${section}_${id}_${field}`]) || 0;
				const commonMultipliers = (fields.length <= destinations.length) ? [] : fields.splice(destinations.length, fields.length - destinations.length);
				const output = {};
				destinations.forEach((destination, index) => {
					output[destination] = idArray.reduce((total, id) => total + getValue(section, id, fields[index]) * commonMultipliers.reduce((subtotal, mult) => subtotal * getValue(section, id, mult), 1), 0);
				});
				setAttrs(output);
			}); 
		}); 
	};
</script>
